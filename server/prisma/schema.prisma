generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// User model - stores user accounts
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String?  // Nullable for external auth
  name      String?
  avatar    String?
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  workspaceMembers WorkspaceMember[]
  requests         Request[]
  history          History[]
}

// Workspace model - container for collections
model Workspace {
  id         String   @id @default(cuid())
  name       String
  slug       String   @unique
  isPersonal Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  members WorkspaceMember[]
}

// WorkspaceMember - links users to workspaces with roles
model WorkspaceMember {
  id          String        @id @default(cuid())
  userId      String
  workspaceId String
  role        WorkspaceRole @default(MEMBER)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId])
  @@index([userId])
  @@index([workspaceId])
}

// Request model - stores API requests made by users
model Request {
  id          String   @id @default(cuid()) 
  name        String
  method      HttpMethod @default(GET)
  url         String
  headers     Json?   // Stored as JSON [{ key: "Content-Type", value: "application/json" }]
  body        String?  
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  history     History[]

  @@index([userId])
}

// History model - logs of executed requests
model History {
  id          String   @id @default(cuid())
  requestId   String
  userId      String
  method      String
  url         String
  statusCode  Int
  responseTime Int?    // in milliseconds
  requestData  Json?   // Full request details
  responseData Json?   // Full response details
  error       String? // Error message if request failed
  createdAt   DateTime @default(now())

  // Relations
  request     Request @relation(fields: [requestId], references: [id], onDelete: Cascade)
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@index([userId])
  @@index([createdAt])
}

// Enums
enum UserRole {
  USER
  ADMIN
}

enum WorkspaceRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum HttpMethod {
  GET
  POST
  PUT
  PATCH
  DELETE
  HEAD
  OPTIONS
}